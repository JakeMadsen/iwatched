<div class="container-fluid">
  <h3>Moderator Nicknames</h3>
  <% if (page_data.ok) { %><div class="alert alert-success">Saved</div><% } %>
  <div class="row">
    <div class="col-md-6">
      <h5>Existing Personas</h5>
      <table class="table table-dark table-striped">
        <thead><tr><th>Avatar</th><th>Name</th><th>Assigned to</th><th></th></tr></thead>
        <tbody>
          <% (page_data.personas||[]).forEach(function(p){ %>
            <tr>
              <td>
                <% if(p.avatar){ %><img src="/static/style/img/personas/<%= p.avatar %>" style="width:32px;height:32px;border-radius:4px;object-fit:cover;"><% } else { %><span class="text-muted">none</span><% } %>
              </td>
              <td><%= p.name %></td>
              <td>
                <% var u = (page_data.users||[]).find(function(u){ return String(u._id)===String(p.assigned_user_id); }); %>
                <%= u ? (u.local && u.local.username) : '-' %>
              </td>
              <td>
                <form method="POST" action="/admin/personas/<%= p._id %>/delete" onsubmit="return confirm('Delete persona?');"><button class="btn btn-sm btn-outline-danger">Delete</button></form>
              </td>
            </tr>
          <% }); %>
        </tbody>
      </table>
    </div>
    <div class="col-md-6">
      <h5>Create Persona</h5>
      <form method="POST" action="/admin/personas" enctype="multipart/form-data">
        <div class="form-group">
          <label>Name</label>
          <input class="form-control" name="name" required>
          <small class="form-text text-muted">Shown to users instead of the moderator’s real name.</small>
        </div>
        <div class="form-group">
          <label>Assign to moderator</label>
          <select class="form-control" name="assigned_user_id">
            <option value="">— None —</option>
            <% (page_data.users||[]).forEach(function(u){ %>
              <option value="<%= u._id %>"><%= u.local && u.local.username %></option>
            <% }); %>
          </select>
          <small class="form-text text-muted">Only admins are listed.</small>
        </div>
        <div class="form-group">
          <label>Avatar</label>
          <input type="file" class="form-control" name="avatar" accept="image/*" />
        </div>
        <button class="btn btn-outline-primary" type="submit">Create</button>
      </form>
    </div>
  </div>
</div>

