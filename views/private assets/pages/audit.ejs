<div class="container" style="margin-top:12px;">
  <h3>Admin Audit</h3>
  <div class="dropdown-divider"></div>
  <div class="form-row" style="margin-bottom:8px;">
    <div class="col-md-4"><input class="form-control" id="audit_q" placeholder="Filter by actor/action/target"></div>
  </div>
  <div class="table-responsive">
    <table class="table table-dark table-striped" id="audit_table">
      <thead><tr><th>Time</th><th>Actor</th><th>Persona</th><th>Action</th><th>Target</th><th>Meta</th></tr></thead>
      <tbody>
        <% (page_data.events||[]).forEach(function(e){ %>
          <tr>
            <td><%= new Date(e.at).toLocaleString() %></td>
            <td><%= e.actor %></td>
            <td><%= e.persona || '-' %></td>
            <td><code><%= e.action %></code></td>
            <td><%= e.target %></td>
            <td><%= e.meta || '' %></td>
          </tr>
        <% }) %>
      </tbody>
    </table>
  </div>
</div>

<script>
(function(){
  document.addEventListener('DOMContentLoaded', function(){
    var q = document.getElementById('audit_q');
    var tb = document.getElementById('audit_table').getElementsByTagName('tbody')[0];
    function filter(){
      var v = (q.value||'').toLowerCase();
      Array.prototype.forEach.call(tb.rows, function(r){
        var t = r.textContent.toLowerCase();
        r.style.display = (!v || t.indexOf(v) !== -1) ? '' : 'none';
      });
    }
    if(q){ q.addEventListener('input', filter); }
  });
})();
</script>

