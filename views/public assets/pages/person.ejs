<div class="container" style="margin-top:16px;">
  <div class="row">
    <div class="col-md-3" style="text-align:center;">
      <% if (page_data.person && page_data.person.profile_path) { %>
        <img class="img-fluid" src="https://image.tmdb.org/t/p/w342/<%= page_data.person.profile_path %>" alt="<%= page_data.person.name %>" style="border-radius:8px;">
      <% } %>
    </div>
    <div class="col-md-9">
      <h1><%= page_data.person && page_data.person.name %></h1>
      <% if (page_data.person && page_data.person.biography) { 
           var _bio = String(page_data.person.biography||'');
           var _limit = 500;
           var _isLong = _bio.length > _limit;
           var _short = _isLong ? _bio.slice(0, _limit) : _bio;
        %>
        <p id="bio-short" style="white-space:pre-wrap; opacity:.9; display:<%= _isLong ? 'block' : 'block' %>;">
          <%= _short %><% if (_isLong) { %>...<% } %>
        </p>
        <% if (_isLong) { %>
        <p id="bio-full" style="white-space:pre-wrap; opacity:.9; display:none;">
          <%= _bio %>
        </p>
        <button id="bio-toggle" class="btn btn-sm btn-outline-light">Read more</button>
        <script>
          (function(){
            var expanded = false;
            var btn = document.getElementById('bio-toggle');
            var shortEl = document.getElementById('bio-short');
            var fullEl = document.getElementById('bio-full');
            if(btn && shortEl && fullEl){
              btn.addEventListener('click', function(){
                expanded = !expanded;
                shortEl.style.display = expanded ? 'none' : 'block';
                fullEl.style.display = expanded ? 'block' : 'none';
                btn.textContent = expanded ? 'Show less' : 'Read more';
              });
            }
          })();
        </script>
        <% } %>
      <% } %>
    </div>
  </div>

  <div style="margin-top:20px;">
    <h3>Movies (Cast)</h3>
    <hr>
    <div class="row">
      <% (page_data.cast_movies||[]).slice(0,24).forEach(function(m){ %>
        <div class="col-md-2 image-box">
          <a href="/movies/<%= m.id %>">
            <% if (typeof user != 'undefined') { %>
              <img class="img-fluid image-box-hover" src="https://image.tmdb.org/t/p/w342/<%= m.poster_path %>" alt="<%= m.title %>"
                   onload="
                      checkIfFavourited('<%= user._id %>', '<%= m.id %>');
                      checkIfWatched('<%= user._id %>', '<%= m.id %>');
                      checkIfSaved('<%= user._id %>', '<%= m.id %>');
                   ">
            <% } else { %>
              <img class="img-fluid image-box-hover" src="https://image.tmdb.org/t/p/w342/<%= m.poster_path %>" alt="<%= m.title %>">
            <% } %>
          </a>
          <div class="movie-hover image-box-description">
            <p><%= m.title %></p>
            <% if (typeof user != 'undefined') { %>
            <div class="row">
              <div class="col-md-4">
                <i class="far fa-check-circle fa-2x icon-white"
                   id="add_watched_movie_<%= m.id %>"
                   onclick="event.stopPropagation(); movieAddWatched('<%= user._id %>', '<%= m.id %>', '', '<%= user.permissions.user_private_key %>'); return false;"></i>
                <i class="fas fa-check-circle fa-2x icon-green"
                   id="remove_watched_movie_<%= m.id %>"
                   onclick="event.stopPropagation(); movieRemoveWatched('<%= user._id %>', '<%= m.id %>', '', '<%= user.permissions.user_private_key %>'); return false;"></i>
              </div>
              <div class="col-md-4">
                <i class="far fa-heart fa-2x icon-white"
                   id="add_favourited_movie_<%= m.id %>"
                   onclick="event.stopPropagation(); movieAddFavourited('<%= user._id %>', '<%= m.id %>', '', '<%= user.permissions.user_private_key %>'); return false;"></i>
                <i class="fas fa-heart fa-2x icon-red"
                   id="remove_favourited_movie_<%= m.id %>"
                   onclick="event.stopPropagation(); movieRemoveFavourited('<%= user._id %>', '<%= m.id %>', '', '<%= user.permissions.user_private_key %>'); return false;"></i>
              </div>
              <div class="col-md-4">
                <i class="far fa-bookmark fa-2x icon-white"
                   id="add_saved_movie_<%= m.id %>"
                   onclick="event.stopPropagation(); movieAddSaved('<%= user._id %>', '<%= m.id %>', '', '<%= user.permissions.user_private_key %>'); return false;"></i>
                <i class="fas fa-bookmark fa-2x icon-blue"
                   id="remove_saved_movie_<%= m.id %>"
                   onclick="event.stopPropagation(); movieRemoveSaved('<%= user._id %>', '<%= m.id %>', '', '<%= user.permissions.user_private_key %>'); return false;"></i>
              </div>
            </div>
            <% } %>
          </div>
        </div>
      <% }); %>
    </div>
  </div>

  <div style="margin-top:20px;">
    <h3>Series (Cast)</h3>
    <hr>
    <div class="row">
      <% (page_data.cast_shows||[]).slice(0,24).forEach(function(s){ %>
        <div class="col-md-2 image-box">
          <a href="/shows/<%= s.id %>">
            <% if (s.poster_path) { %>
              <img class="img-fluid image-box-hover" src="https://image.tmdb.org/t/p/w342/<%= s.poster_path %>" alt="<%= s.name %>">
            <% } %>
            <div class="movie-hover image-box-description"><p><%= s.name %></p></div>
          </a>
        </div>
      <% }); %>
    </div>
  </div>

  <% if ((page_data.crew_movies||[]).length) { %>
  <div style="margin-top:20px;">
    <h3>Directed</h3>
    <hr>
    <div class="row">
      <% (page_data.crew_movies||[]).slice(0,24).forEach(function(m){ %>
        <div class="col-md-2 image-box">
          <a href="/movies/<%= m.id %>">
            <% if (typeof user != 'undefined') { %>
              <img class="img-fluid image-box-hover" src="https://image.tmdb.org/t/p/w342/<%= m.poster_path %>" alt="<%= m.title %>"
                   onload="
                      checkIfFavourited('<%= user._id %>', '<%= m.id %>');
                      checkIfWatched('<%= user._id %>', '<%= m.id %>');
                      checkIfSaved('<%= user._id %>', '<%= m.id %>');
                   ">
            <% } else { %>
              <img class="img-fluid image-box-hover" src="https://image.tmdb.org/t/p/w342/<%= m.poster_path %>" alt="<%= m.title %>">
            <% } %>
          </a>
          <div class="movie-hover image-box-description">
            <p><%= m.title %></p>
            <% if (typeof user != 'undefined') { %>
            <div class="row">
              <div class="col-md-4">
                <i class="far fa-check-circle fa-2x icon-white"
                   id="add_watched_movie_<%= m.id %>"
                   onclick="event.stopPropagation(); movieAddWatched('<%= user._id %>', '<%= m.id %>', '', '<%= user.permissions.user_private_key %>'); return false;"></i>
                <i class="fas fa-check-circle fa-2x icon-green"
                   id="remove_watched_movie_<%= m.id %>"
                   onclick="event.stopPropagation(); movieRemoveWatched('<%= user._id %>', '<%= m.id %>', '', '<%= user.permissions.user_private_key %>'); return false;"></i>
              </div>
              <div class="col-md-4">
                <i class="far fa-heart fa-2x icon-white"
                   id="add_favourited_movie_<%= m.id %>"
                   onclick="event.stopPropagation(); movieAddFavourited('<%= user._id %>', '<%= m.id %>', '', '<%= user.permissions.user_private_key %>'); return false;"></i>
                <i class="fas fa-heart fa-2x icon-red"
                   id="remove_favourited_movie_<%= m.id %>"
                   onclick="event.stopPropagation(); movieRemoveFavourited('<%= user._id %>', '<%= m.id %>', '', '<%= user.permissions.user_private_key %>'); return false;"></i>
              </div>
              <div class="col-md-4">
                <i class="far fa-bookmark fa-2x icon-white"
                   id="add_saved_movie_<%= m.id %>"
                   onclick="event.stopPropagation(); movieAddSaved('<%= user._id %>', '<%= m.id %>', '', '<%= user.permissions.user_private_key %>'); return false;"></i>
                <i class="fas fa-bookmark fa-2x icon-blue"
                   id="remove_saved_movie_<%= m.id %>"
                   onclick="event.stopPropagation(); movieRemoveSaved('<%= user._id %>', '<%= m.id %>', '', '<%= user.permissions.user_private_key %>'); return false;"></i>
              </div>
            </div>
            <% } %>
          </div>
        </div>
      <% }); %>
    </div>
  </div>
  <% } %>
</div>
