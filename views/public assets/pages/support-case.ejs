<div class="container" style="margin-top:16px;">
  <div class="row">
    <div class="col-md-6">
      <div style="display:flex;justify-content:space-between;align-items:center;gap:12px;">
        <h4 style="margin:0;">Support Case</h4>
        <a class="btn btn-sm btn-secondary" href="/support">‚Üê Back to all cases</a>
      </div>
      <p><strong>Title:</strong> <%= page_data.found_case.title %></p>
      <p><strong>Open date:</strong> <%= new Date(page_data.found_case.opened_date).toLocaleString() %></p>
      <p><strong>Last update:</strong> <%= new Date(page_data.found_case.last_updated).toLocaleString() %></p>
      <p><strong>Resolved:</strong> <%= page_data.found_case.resolved %></p>

      <% if (page_data.found_case.resolved) { %>
        <div class="alert alert-info" role="alert">This case is closed.</div>
        <form action="/support/<%= page_data.found_case._id %>/reopen" method="POST">
          <button type="submit" class="btn btn-primary btn-block">Re-open case</button>
        </form>
      <% } else { %>
        <form action="/support/<%= page_data.found_case._id %>" method="POST" style="margin-bottom:10px;">
          <div class="form-group">
            <label for="message_text">Send new message</label>
            <textarea name="message" id="message_text" rows="6" class="form-control" required></textarea>
          </div>
          <button type="submit" class="btn btn-primary btn-block">Send</button>
        </form>
        <form action="/support/<%= page_data.found_case._id %>/close" method="POST">
          <button type="submit" class="btn btn-outline-light btn-block">Close case</button>
        </form>
      <% } %>
    </div>
    <div class="col-md-6">
      <h4>Messages</h4>
      <div class="dropdown-divider" style="margin: 0 0 10px 0"></div>
      <% (page_data.found_case.messages||[]).forEach(function(message){ %>
        <div style="display:flex; gap:10px; align-items:flex-start; margin-bottom:12px;">
          <% if (message.persona_avatar) { %>
            <img src="/static/style/img/personas/<%= message.persona_avatar %>" style="width:36px;height:36px;border-radius:50%;object-fit:cover;">
          <% } else if (message.user_avatar) { %>
            <img src="<%= message.user_avatar %>" style="width:36px;height:36px;border-radius:50%;object-fit:cover;">
          <% } %>
          <div>
            <div style="font-weight:700; color:#fff;">
              <%= message.persona_name || message.username || (message.author_type==='support'?'Support':'User') %>
              <span style="color:rgba(255,255,255,0.75); font-weight:400; margin-left:8px; font-size:12px;"><%= new Date(message.date).toLocaleString() %></span>
            </div>
            <div style="white-space:pre-wrap; color:#fff;"> <%= message.message %> </div>
          </div>
        </div>
        <div class="dropdown-divider" style="margin: 0 0 10px 0"></div>
      <% }); %>
    </div>
  </div>
</div>
