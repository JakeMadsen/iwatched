<style>
  @media (min-width: 992px){
    #shows_holder{ overflow-y: auto; }
  }
  .genre-active-tag{ font-size:10px; margin-left:6px; opacity:.8; }
  /* Space between genre pills and grid, remove any row-wide background */
  #shows_holder{ margin-top: 18px; background: transparent !important; }
  #shows_holder .row{ background: transparent !important; }
  #shows_holder > [class^='col-'],
  #shows_holder > [class*=' col-'],
  #shows_holder [class^='col-'],
  #shows_holder [class*=' col-']{ background: transparent !important; box-shadow: none !important; }
  /* Constrain overlay to poster and make only poster clickable */
  #shows_holder .image-box{ text-align:center; }
  #shows_holder .image-box > a{ position: relative; display:inline-block; overflow:hidden; }
  #shows_holder .image-box img{ display:block; }
</style>

<div class="container" style="margin-top: 10px;">
  <div class="d-flex flex-column flex-md-row align-items-md-center">
    <div class="mr-md-4" style="flex:0 0 auto;">
      <h1 class="mb-2" style="font-size: 28px;">Browse series</h1>
      <div style="opacity:.7; font-size: 14px;">Find TV shows by title or genre</div>
    </div>
    <form class="ml-md-auto mt-3 mt-md-0" style="flex:1 1 auto; max-width: 520px;" onsubmit="event.preventDefault(); searchShows();">
      <div class="input-group">
        <input id="search_input" name="search_input" type="text" class="form-control" placeholder="Search for a series...">
        <div class="input-group-append">
          <button class="btn btn-primary" type="submit"><i class="fas fa-search"></i></button>
        </div>
      </div>
    </form>
  </div>

  <% if ((page_data.genres||[]).length) { %>
    <div class="mt-3">
      <% var __curr = (page_data && page_data.current_genre) ? String(page_data.current_genre).toLowerCase() : ''; %>
      <% page_data.genres.forEach(function (genre){ 
           var gname = String(genre.name||'');
           var slug = gname.toLowerCase();
           var isA = (slug === __curr);
      %>
        <a class="badge badge-pill <%= isA ? 'badge-accent' : 'badge-secondary' %> mr-2 mb-2" href="?genre=<%= encodeURIComponent(slug) %>" <%= isA ? 'aria-current="true"' : '' %>><%= gname %></a>
      <% }); %>
    </div>
  <% } %>
</div>

<div class="container">
  <div id="shows_holder" class="row mt-3"></div>

  <div id="view_more" style="display: none;">
    <div class="page-load-status">
      <div class="loader-ellips infinite-scroll-request">
        <span class="loader-ellips__dot"></span>
        <span class="loader-ellips__dot"></span>
        <span class="loader-ellips__dot"></span>
        <span class="loader-ellips__dot"></span>
      </div>
      <p class="infinite-scroll-last">End of content</p>
      <p class="infinite-scroll-error">No more pages to load</p>
    </div>
    <!-- Removed View More button for continuous scroll on shows -->
  </div>
</div>

<script>
  (function(){
    function adjustShowsGridHeight(){
      try {
        var holder = document.getElementById('shows_holder');
        if (!holder) return;
        var isDesktop = window.matchMedia('(min-width: 992px)').matches;
        if (!isDesktop){ holder.style.maxHeight=''; return; }
        // Measure a sample item to fit exactly 3 rows
        var sample = holder.querySelector('.image-box');
        if (!sample){ return; }
        var box = sample.getBoundingClientRect();
        var gap = 16; // approximate vertical spacing between rows
        var height = Math.round((box.height * 3) + (gap * 2));
        holder.style.maxHeight = height + 'px';
      } catch(_){}
    }
    window.addEventListener('resize', function(){ adjustShowsGridHeight(); });
    document.addEventListener('DOMContentLoaded', function(){ setTimeout(adjustShowsGridHeight, 300); });
    // Expose for search_shows.js to call after appends
    window.__adjustShowsGridHeight = adjustShowsGridHeight;
  })();
</script>

<script type="text/html" id="show-template">
  <div class="col-md-2 image-box" data-tmd-id="{{id}}">
    <a href="/shows/{{id}}-{{slug}}">
      <img class="img-fluid image-box-hover" loading="lazy" decoding="async" src="https://image.tmdb.org/t/p/w342/{{poster_path}}" alt=""
        <% if (typeof user != 'undefined') { %>
        onload="checkIfFavouritedShow('<%= user._id %>', '{{id}}'); checkIfWatchedShow('<%= user._id %>', '{{id}}'); checkIfSavedShow('<%= user._id %>', '{{id}}');"
        <% } %>
      >
      <div class="movie-hover image-box-description">
        <div class="movie-title" title="{{name}}">{{name}}</div>
        <div class="movie-actions">
          <% if (typeof user != 'undefined') { %>
          <i class="far fa-check-circle fa-2x icon-white" id="add_watched_show_{{id}}" onclick="event.stopPropagation(); showAddWatched('<%= user._id %>', '{{id}}', '', '<%= user.permissions.user_private_key %>'); return false;"></i>
          <i class="fas fa-check-circle fa-2x icon-green" id="remove_watched_show_{{id}}" onclick="event.stopPropagation(); showRemoveWatched('<%= user._id %>', '{{id}}', '', '<%= user.permissions.user_private_key %>'); return false;"></i>
          <i class="far fa-heart fa-2x icon-white" id="add_favourited_show_{{id}}" onclick="event.stopPropagation(); showAddFavourited('<%= user._id %>', '{{id}}', '<%= user.permissions.user_private_key %>'); return false;"></i>
          <i class="fas fa-heart fa-2x icon-red" id="remove_favourited_show_{{id}}" onclick="event.stopPropagation(); showRemoveFavourited('<%= user._id %>', '{{id}}', '<%= user.permissions.user_private_key %>'); return false;"></i>
          <i class="far fa-bookmark fa-2x icon-white" id="add_saved_show_{{id}}" onclick="event.stopPropagation(); showAddSaved('<%= user._id %>', '{{id}}', '<%= user.permissions.user_private_key %>'); return false;"></i>
          <i class="fas fa-bookmark fa-2x icon-blue" id="remove_saved_show_{{id}}" onclick="event.stopPropagation(); showRemoveSaved('<%= user._id %>', '{{id}}', '<%= user.permissions.user_private_key %>'); return false;"></i>
          <% } %>
        </div>
      </div>
    </a>
  </div>
  </script>
