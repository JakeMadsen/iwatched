<div style="background-color: dimgrey; background-repeat: no-repeat; background-size: cover; background-image: url(https://image.tmdb.org/t/p/original/<%= page_data.show.backdrop_path %>)">
    <div class="container">
        <% if (page_data.show_videos.length != '0' ) { %>
        <div class="embed-responsive embed-responsive-16by9">
            <iframe class="embed-responsive-item" src="https://www.youtube.com/embed/<%= page_data.show_videos[0].key %>"
                allowfullscreen></iframe>
        </div>
        <% } %>
    </div>
</div>


<div class="container">
    <!-- Show tag line -->
    <div class="row">
        <div class="col-md-12">
            <p class="text-center">
                <b>
                    <%= page_data.show.tagline %></b>
            </p>
        </div>

    </div>

    <!-- Show Information -->
    <div class="row">
        <!-- If there is a video, show full width layout -->
        <% if ((page_data.show_videos||[]).length != '0' ) { %>
        <div class="col-md-12">
            <div class="row">
                <div class="col-md-10">
                    <h1><%= page_data.show.name %></h1>
                </div>
                <div class="col-md-2">
                    <div class="text-right" style="margin-top:8px;">
                        <a style="color:lightblue;" href="https://www.themoviedb.org/tv/<%= page_data.show.id %>">Report</a>
                    </div>
                </div>
            </div>
            <!-- Modernized info section -->
            <div class="row" style="margin-top:6px;">
                <div class="col-md-12">
                    <div style="color: #fff; margin:6px 0 10px; display:flex; align-items:center; gap:10px; flex-wrap:wrap;">
                        <% var year = (page_data.show.first_air_date||'').toString().slice(0,4); %>
                        <% if (year) { %><span style="opacity:.85;"> <%= year %> </span><% } %>
                        <% if (page_data.show.vote_average) { var __v = Number(page_data.show.vote_average||0); var __vr = Math.round(__v*2)/2; var __vrStr = (__vr % 1 === 0) ? __vr.toFixed(0) : __vr.toFixed(1); %>
                            <span style="opacity:.85;">★ <%= __vrStr %>/10</span>
                        <% } %>
                        <% if (page_data.show.number_of_seasons) { %>
                            <span style="opacity:.85;">Seasons: <%= page_data.show.number_of_seasons %></span>
                        <% } %>
                        <% if (page_data.show.number_of_episodes) { %>
                            <span style="opacity:.85;">Episodes: <%= page_data.show.number_of_episodes %></span>
                        <% } %>
                        <% if ((page_data.creators||[]).length) { %>
                            <span style="opacity:.85;">Created by 
                                <% page_data.creators.slice(0,2).forEach(function(c, i){ %>
                                    <a href="/person/<%= c.id %>" style="color: lightblue;"> <%= c.name %></a><%= (i<Math.min(1,page_data.creators.length-1)) ? ',' : '' %>
                                <% }) %>
                            </span>
                        <% } %>
                    </div>
                    <% if ((page_data.show.genres||[]).length) { %>
                    <div style="margin: 4px 0 14px;">
                        <% page_data.show.genres.forEach(function (genre, index){ %>
                            <a href="/shows?genre=<%= genre.name.toLowerCase() %>" class="badge badge-secondary" style="margin-right:6px; background:rgba(255,255,255,.08); color:#fff;"> <%= genre.name %> </a>
                        <% }); %>
                    </div>
                    <% } %>
                    <!-- Info cards (parity with movies) -->
                    <div class="info-cards">
                        <div class="row">
                            <div class="col-md-3" style="margin-bottom:10px;">
                                <div class="info-card">
                                    <div class="label">First Air Date</div>
                                    <div class="value"><%= page_data.show.first_air_date || '—' %></div>
                                </div>
                            </div>
                            <div class="col-md-3" style="margin-bottom:10px;">
                                <div class="info-card">
                                    <div class="label">Total Runtime</div>
                                    <div class="value"><span id="total_runtime_value"><%= page_data.total_runtime_text || '—' %></span>
                                      <% if (page_data.total_runtime_text) { %>
                                        <span id="total_runtime_hint" style="opacity:.7; font-size: 85%;"> (est.)</span>
                                      <% } %>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-3" style="margin-bottom:10px;">
                                <div class="info-card">
                                    <div class="label">Creator</div>
                                    <div class="value">
                                        <% if ((page_data.creators||[]).length) { %>
                                            <a href="/person/<%= page_data.creators[0].id %>" style="color:#fff;"> <%= page_data.creators[0].name %></a>
                                        <% } else { %>
                                            —
                                        <% } %>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-3" style="margin-bottom:10px;">
                                <div class="info-card">
                                    <div class="label">Episodes</div>
                                    <div class="value"><%= page_data.show.number_of_episodes || '—' %></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div style="color:#fff; opacity:.9;">
                        <%= page_data.show.overview %>
                    </div>
                </div>
            </div>
        </div>
        <% } else { %>
        <!-- If no video, keep 3-column layout -->
        <div class="col-md-12">
            <div class="row">
                <div class="col-md-9">
                    <h1><%= page_data.show.name %></h1>
                    <div style="color: #fff; margin:6px 0 10px; display:flex; align-items:center; gap:10px; flex-wrap:wrap;">
                        <% var year2 = (page_data.show.first_air_date||'').toString().slice(0,4); %>
                        <% if (year2) { %><span style="opacity:.85;"> <%= year2 %> </span><% } %>
                        <% if (page_data.show.vote_average) { var __v2 = Number(page_data.show.vote_average||0); var __vr2 = Math.round(__v2*2)/2; var __vrStr2 = (__vr2 % 1 === 0) ? __vr2.toFixed(0) : __vr2.toFixed(1); %>
                            <span style="opacity:.85;">★ <%= __vrStr2 %>/10</span>
                        <% } %>
                        <% if (page_data.show.number_of_seasons) { %>
                            <span style="opacity:.85;">Seasons: <%= page_data.show.number_of_seasons %></span>
                        <% } %>
                        <% if (page_data.show.number_of_episodes) { %>
                            <span style="opacity:.85;">Episodes: <%= page_data.show.number_of_episodes %></span>
                        <% } %>
                    </div>
                    <% if ((page_data.show.genres||[]).length) { %>
                    <div style="margin: 4px 0 14px;">
                        <% page_data.show.genres.forEach(function (genre, index){ %>
                            <a href="/shows?genre=<%= genre.name.toLowerCase() %>" class="badge badge-secondary" style="margin-right:6px; background:rgba(255,255,255,.08); color:#fff;"> <%= genre.name %> </a>
                        <% }); %>
                    </div>
                    <% } %>
                    <!-- Info cards -->
                    <div class="info-cards">
                        <div class="row">
                            <div class="col-md-3" style="margin-bottom:10px;">
                                <div class="info-card">
                                    <div class="label">First Air Date</div>
                                    <div class="value"><%= page_data.show.first_air_date || '—' %></div>
                                </div>
                            </div>
                            <div class="col-md-3" style="margin-bottom:10px;">
                                <div class="info-card">
                                    <div class="label">Total Runtime</div>
                                    <div class="value"><span id="total_runtime_value_novid"><%= page_data.total_runtime_text || '—' %></span>
                                      <% if (page_data.total_runtime_text) { %>
                                        <span id="total_runtime_hint_novid" style="opacity:.7; font-size: 85%;"> (est.)</span>
                                      <% } %>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-3" style="margin-bottom:10px;">
                                <div class="info-card">
                                    <div class="label">Creator</div>
                                    <div class="value">
                                        <% if ((page_data.creators||[]).length) { %>
                                            <a href="/person/<%= page_data.creators[0].id %>" style="color:#fff;"> <%= page_data.creators[0].name %></a>
                                        <% } else { %>
                                            —
                                        <% } %>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-3" style="margin-bottom:10px;">
                                <div class="info-card">
                                    <div class="label">Episodes</div>
                                    <div class="value"><%= page_data.show.number_of_episodes || '—' %></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div style="opacity:.9;">
                        <%= page_data.show.overview %>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="text-right" style="margin-top:8px;">
                        <a style="color:lightblue;" href="https://www.themoviedb.org/tv/<%= page_data.show.id %>">Report</a>
                    </div>
                    <% if ((page_data.creators||[]).length) { %>
                    <div style="margin-top:12px;">
                        <h1>Creator<%= page_data.creators.length>1 ? 's' : '' %></h1>
                        <hr>
                        <% page_data.creators.forEach(function(c){ %>
                            <div style="display:flex;align-items:center;gap:8px;margin-top:6px;">
                                <% if (c.profile_path) { %>
                                    <a href="/person/<%= c.id %>"><img src="https://image.tmdb.org/t/p/w185/<%= c.profile_path %>" style="width:42px;height:42px;border-radius:50%;object-fit:cover;"></a>
                                <% } %>
                                <a href="/person/<%= c.id %>" style="color: lightblue;"><%= c.name %></a>
                            </div>
                        <% }); %>
                    </div>
                    <% } %>
                </div>
            </div>
        </div>
        <% } %>
    </div>

    <% if ((page_data.cast||[]).length) { %>
    <div style="margin-top:20px;">
        <h2>Cast</h2>
        <hr>
        <div class="row cast-scroll">
            <% page_data.cast.forEach(function (p, index){ if (index < 20) { %>
                <div class="col-md-2 cast-item">
                    <a href="/person/<%= p.id %>">
                        <% if (p.profile_path) { %>
                            <img class="img-fluid" src="https://image.tmdb.org/t/p/w185/<%= p.profile_path %>" alt="<%= p.name %>" style="border-radius:6px;">
                        <% } %>
                        <div style="color:#fff; font-weight:600; margin-top:6px;"><%= p.name %></div>
                        <div style="opacity:.8; color:#ccc; font-size:12px;">
                            <%= p.character %>
                        </div>
                    </a>
                </div>
            <% } }); %>
        </div>
    </div>
    <% } %>


    <!-- Show seasons -->
    <h2>Seasons</h2>
    <hr>
    <div class="row">
        <% page_data.show.seasons.forEach(function (season, index){ %>
            <% if(season.name.toString() != "Specials") { %>
            <div class="col-md-2 image-box">
                <a href="/shows/<%= page_data.show.id %>/season/<%= season.season_number %>">
                    <img class="img-fluid image-box-hover" style="margin-bottom: 20px;" src="https://image.tmdb.org/t/p/w500/<%= season.poster_path %>"
                        alt="">
                    <div class="movie-hover">
                        <h2>
                            <%= season.name %>
                        </h2>
                    </div>
                </a>
            </div>
            <% } %>
        <% }); %>
    </div>




    <!-- Similar Shows -->
    <% if ((page_data.similar||[]).length) { %>
    <div>
        <h2>Similar Shows</h2>
        <hr>
        <div class="row">
            <% page_data.similar.forEach(function (s, index){ if(index < 12) { %>
                <div class="col-md-2 image-box">
                    <a href="/shows/<%= s.id %>">
                        <img class="img-fluid image-box-hover" src="https://image.tmdb.org/t/p/w500/<%= s.poster_path %>" alt="">
                    </a>
                    <div class="movie-hover image-box-description">
                        <p><%= s.name %></p>
                    </div>
                </div>
            <% } }); %>
        </div>
    </div>
    <% } %>
</div>

<script>
(function(){
  // Upgrade estimated runtime to precise value asynchronously
  document.addEventListener('DOMContentLoaded', function(){
    var id = <%- JSON.stringify(page_data.show && page_data.show.id) %>;
    if(!id) return;
    fetch('/api/v1/shows/' + id + '/runtime')
      .then(function(r){ return r.ok ? r.json() : null; })
      .then(function(data){
        if(!data || !data.text) return;
        var el1 = document.getElementById('total_runtime_value');
        var h1 = document.getElementById('total_runtime_hint');
        var el2 = document.getElementById('total_runtime_value_novid');
        var h2 = document.getElementById('total_runtime_hint_novid');
        [el1,el2].forEach(function(el){ if(el){ el.textContent = data.text; }});
        [h1,h2].forEach(function(h){ if(h){ h.parentNode && h.parentNode.removeChild(h); }});
      }).catch(function(){});
  });
})();
</script>
